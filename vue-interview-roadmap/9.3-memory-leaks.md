# 9.3 What are common memory leaks in Vue and how do you avoid them?

## Quick Revision
- Memory leaks often stem from lingering event listeners, timers, or subscriptions not cleaned up on unmount.
- Use lifecycle hooks (`onBeforeUnmount`) to remove listeners, cancel requests, and clear intervals.
- Watch for detached DOM nodes from third-party libraries and leverage weak references or plugin teardown APIs.

## Detailed Explanation
### Sources of Leaks
Components that attach global event listeners (`window`, `document`), websockets, or intervals can leak if not removed during teardown. Third-party libraries that imperatively manipulate the DOM may leave detached nodes. Retained references in closures can also prevent garbage collection.

### Prevention
Use `onBeforeUnmount`/`onUnmounted` to clean up listeners and timers. Wrap external subscriptions in composables that manage cleanup. For watchers, stop them manually with the returned stop handle when no longer needed. Avoid storing DOM elements or component instances in long-lived singletons.

### Diagnostics
Use browser memory profiles and heap snapshots to track retained objects. Vue DevTools performance timeline can reveal components not being destroyed. Tools like `why-did-you-render` alternatives or manual logging help detect repeated mount/unmount cycles without cleanup.

## Code Example
```js
import { onMounted, onBeforeUnmount } from 'vue';

onMounted(() => {
  window.addEventListener('resize', handler);
});

onBeforeUnmount(() => {
  window.removeEventListener('resize', handler);
});
```

## Resources
- [Vue.js Docs – Performance: Avoid Memory Leaks](https://vuejs.org/guide/best-practices/performance.html#avoid-memory-leaks) – official guidance on cleanup.
- [MDN – Memory Management](https://developer.mozilla.org/docs/Web/JavaScript/Memory_Management) – fundamentals of garbage collection and leaks.
- [Vue School – Preventing Memory Leaks](https://vueschool.io/articles/vuejs-tutorials/how-to-prevent-memory-leaks-in-vue-js-applications/) – examples of common pitfalls.
