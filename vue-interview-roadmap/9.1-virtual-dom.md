# 9.1 How does Vue handle DOM updates with its virtual DOM?

## Quick Revision
- Vue compiles templates into render functions that produce virtual DOM (VNode) trees.
- When reactive state changes, Vue diffs the new VNode tree against the previous tree to compute minimal DOM patches.
- Vue’s compiler generates optimized blocks and patch flags to skip static sections and accelerate updates.

## Detailed Explanation
### Virtual DOM Rendering
Templates compile to `render` functions returning VNodes (`h(type, props, children)`). On initial render, Vue converts VNodes to real DOM. Subsequent renders generate new VNodes which are diffed against the old ones.

### Diffing Algorithm
Vue uses a fast, optimized diffing algorithm with heuristics. It compares nodes by type and key, reusing DOM elements where possible. For lists, keys guide reordering via longest increasing subsequence (LIS) to minimize moves. Patch flags annotate dynamic parts (e.g., text, class) so Vue only updates what changed.

### Compiler Optimizations
Vue 3’s compiler detects static nodes and hoists them out of render functions, marking dynamic nodes with patch flags (e.g., `TEXT`, `CLASS`). Block tree tracking groups dynamic children for targeted updates, reducing diff cost. Fragments allow multiple root nodes without extra wrappers.

## Code Example
```js
import { h, ref } from 'vue';

export default {
  setup() {
    const count = ref(0);
    return () => h('button', { onClick: () => count.value++ }, `Count: ${count.value}`);
  },
};
```
This render function creates a VNode for the button each render; Vue updates only the text content when `count` changes.

## Resources
- [Vue.js Docs – Rendering Mechanism](https://vuejs.org/guide/extras/rendering-mechanism.html) – explains virtual DOM and patching.
- [Vue.js Docs – Template Compilation](https://vuejs.org/guide/extras/render-function.html) – shows how templates become render functions.
- [Vue 3 Source – Renderer](https://github.com/vuejs/core/blob/main/packages/runtime-core/src/renderer.ts) – implementation of the patch algorithm and block tree optimizations.
