# 5.1 How do Vue Router navigation guards work?

## Quick Revision
- Navigation guards are hooks that execute during route changes, allowing auth checks, redirects, or data fetching.
- Guards exist globally (`beforeEach`, `beforeResolve`, `afterEach`), per-route (`beforeEnter`), and in-component (`beforeRouteEnter`, etc.).
- Guards must call `next()` (Vue Router 3) or return values/promises (Vue Router 4) to control navigation flow.

## Detailed Explanation
### Guard Lifecycle
When navigating, Vue Router evaluates guards in order: leaving guards (`beforeRouteLeave`), global `beforeEach`, per-route `beforeEnter`, in-component `beforeRouteEnter`, and finally `beforeResolve`. After the navigation is confirmed, `afterEach` runs. Guards can cancel, redirect, or allow navigation.

### Vue Router 4 Syntax
In Vue Router 4 (Vue 3), guards can return `false` (cancel), a route location (redirect), or a promise. Asynchronous guards can `await` operations. You no longer call `next()`; returning suffices (though `next` still works for compatibility). Guards receive `to`, `from`, and a `next` callback.

### Use Cases
Common uses include authentication (redirect to login if not authorized), fetching data before entering a route, analytics tracking, or confirming unsaved changes. Combine guards with meta fields (e.g., `meta.requiresAuth`) to centralize logic.

## Code Example
```js
// router.js
router.beforeEach(async (to, from) => {
  if (to.meta.requiresAuth && !(await isAuthenticated())) {
    return { name: 'login', query: { redirect: to.fullPath } };
  }
  // returning nothing continues navigation
});
```

## Resources
- [Vue Router Docs – Navigation Guards](https://router.vuejs.org/guide/advanced/navigation-guards.html) – full lifecycle explanation.
- [Vue Router Docs – Meta Fields](https://router.vuejs.org/guide/advanced/meta.html) – using meta info with guards.
- [Vue Router Docs – Composition API](https://router.vuejs.org/guide/advanced/composition-api.html) – using guards with composition utilities like `onBeforeRouteUpdate`.
