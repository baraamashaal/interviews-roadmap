# 10.2 Explain hydration in Vue SSR.

## Quick Revision
- Hydration attaches Vue’s runtime to server-rendered HTML, reusing markup instead of re-rendering from scratch.
- Vue compares server-rendered DOM with client-side virtual DOM; mismatches trigger warnings and full re-render of the subtree.
- Proper hydration requires deterministic markup and avoiding browser-only APIs during server rendering.

## Detailed Explanation
### Hydration Flow
After SSR sends HTML, the client downloads the JavaScript bundle. Vue creates a virtual DOM tree and walks the existing DOM to attach event listeners and reactive bindings. As long as the DOM matches expectations, Vue reuses nodes, leading to fast interactive startup.

### Handling Mismatches
If server and client render different DOM (e.g., using `Date.now()`), Vue logs hydration mismatch warnings and falls back to client rendering for that subtree. Use deterministic data, or gate browser-only logic behind `onMounted` or `process.client` checks in Nuxt.

### Streaming & Suspense
Vue 3 SSR supports streaming and Suspense, which delay hydration for async components until data resolves. On the client, hydration occurs when the async content is available, ensuring consistent markup.

## Code Example
```js
// SSR entry
export async function render(url) {
  const app = createApp(App);
  const html = await renderToString(app);
  return html;
}

// Client entry
const app = createApp(App);
app.mount('#app'); // hydrates existing markup
```

## Resources
- [Vue.js Docs – Hydration](https://vuejs.org/guide/scaling-up/ssr.html#client-hydration) – official explanation of hydration process.
- [Nuxt 3 Docs – Rendering](https://nuxt.com/docs/guide/concepts/rendering) – describes hydration in hybrid rendering.
- [Vue SSR Guide – Mismatch Handling](https://vuejs.org/guide/scaling-up/ssr.html#hydration-mismatch) – how Vue resolves DOM mismatches.
